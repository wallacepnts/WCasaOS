name: paperless-ngx
services:
  broker:
    image: docker.io/library/redis:7
    restart: unless-stopped
    volumes:
      - DATA/AppData/$AppID/data:/data
  db:
    image: docker.io/library/postgres:16
    restart: unless-stopped
    volumes:
      - DATA/AppData/$AppID/pgdata:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: paperless
      POSTGRES_USER: paperless
      POSTGRES_PASSWORD: paperless
  webserver:
    image: ghcr.io/paperless-ngx/paperless-ngx:latest
    restart: unless-stopped
    depends_on:
      - db
      - broker
      - gotenberg
      - tika
    ports:
      - "8000:8000"
    volumes:
      - DATA/AppData/$AppID/data:/usr/src/paperless/data
      - DATA/AppData/$AppID/media:/usr/src/paperless/media
      - DATA/AppData/$AppID/export:/usr/src/paperless/export
      - DATA/AppData/$AppID/data/consume:/usr/src/paperless/consume
    environment:
      PAPERLESS_REDIS: redis://broker:6379
      PAPERLESS_DBHOST: db
      PAPERLESS_TIKA_ENABLED: 1
      PAPERLESS_TIKA_GOTENBERG_ENDPOINT: http://gotenberg:3000
      PAPERLESS_TIKA_ENDPOINT: http://tika:9998
  gotenberg:
    image: docker.io/gotenberg/gotenberg:8.7
    restart: unless-stopped

    # The gotenberg chromium route is used to convert .eml files. We do not
    # want to allow external content like tracking pixels or even javascript.
    command:
      - "gotenberg"
      - "--chromium-disable-javascript=true"
      - "--chromium-allow-list=file:///tmp/.*"

  tika:
    image: docker.io/apache/tika:latest
    restart: unless-stopped
    x-casaos:
      envs:
        - container: PUID
          description:
            en_us: ""
        - container: PGID
          description:
            en_us: ""
        - container: TZ
          description:
            en_us: ""
      ports:
        - container: "8000"
          description:
            en_us: ""

      volumes:
        - container: /config
          description:
            en_us: ""
        - container: /data
          description:
            en_us: ""
    container_name: paperless-ngx
x-casaos:
  architectures:
    - amd64
    - arm64
  main: paperless-ngx
  author: Wallace
  category: Backup
  description:
    en_us: Syncthing is a continuous file synchronization program. It synchronizes files between two or more computers in real time, safely protected from prying eyes. Your data is your data alone and you deserve to choose where it is stored, whether it is shared with some third party, and how it's transmitted over the internet.
  developer: Syncthing
  icon: https://icon.casaos.io/main/all/paperless.png
  title:
    en_us: Paperless
  tips:
    before_install:
    en_us:
        (some notes for user to read prior to installation, such as preset `username` and `password` - markdown is supported!)
  index: /
  port_map: "8000"